(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{87593:function(e,t,s){Promise.resolve().then(s.bind(s,84375))},84375:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return E}});var a=s(57437),l=s(2265),n=s(86402),r=s(52731),i=s(86574),o=s(92619),c=s(34709),d=s(338),m=s(29387);function u(e){let{role:t,content:s}=e;return(0,a.jsxs)("div",{className:"chat ".concat("user"===t?"chat-end":"chat-start"," mb-4 px-4 lg:px-8"),children:[(0,a.jsx)("div",{className:"chat-image avatar placeholder",children:(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-base-300 flex items-center justify-center ring-1 ring-base-content/10",children:(0,a.jsx)("div",{className:"w-6 h-6 flex items-center justify-center",children:"user"===t?(0,a.jsx)(d.Z,{className:"w-5 h-5 text-base-content/70"}):(0,a.jsx)(m.Z,{className:"w-5 h-5 text-base-content/70"})})})}),(0,a.jsx)("div",{className:"chat-bubble ".concat("chat-bubble-neutral"," max-w-[85%] lg:max-w-[75%]"),children:(0,a.jsx)("div",{className:"prose ".concat("user"===t?"prose-invert":""," prose-headings:text-base-content prose-strong:text-base-content prose-p:text-base-content max-w-none"),children:(0,a.jsx)(r.D,{remarkPlugins:[c.Z],components:{code(e){let{node:t,inline:s,className:l,children:n,...r}=e,c=/language-(\w+)/.exec(l||"");return s?(0,a.jsx)("code",{className:"".concat(l||""," rounded bg-base-300/50 px-1 text-base-content"),...r,children:n}):(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden my-2",children:[(0,a.jsxs)("div",{className:"bg-neutral-focus text-neutral-content text-xs px-3 py-1 flex items-center justify-between",children:[(0,a.jsx)("span",{children:(null==c?void 0:c[1])||"code"}),(0,a.jsx)("button",{className:"btn btn-xs btn-ghost",onClick:()=>navigator.clipboard.writeText(String(n)),children:"Copy"})]}),(0,a.jsx)(i.Z,{language:c?c[1]:"",style:o.vk,customStyle:{margin:0,borderRadius:"0 0 0.5rem 0.5rem"},children:String(n).replace(/\n$/,"")})]})},p(e){let{children:t}=e;return(0,a.jsx)("p",{className:"mb-4 last:mb-0 leading-7 text-base-content/90",children:t})},ul(e){let{children:t}=e;return(0,a.jsx)("ul",{className:"list-disc list-inside mb-4 last:mb-0 space-y-1 text-base-content/90",children:t})},ol(e){let{children:t}=e;return(0,a.jsx)("ol",{className:"list-decimal list-inside mb-4 last:mb-0 space-y-1 text-base-content/90",children:t})},table(e){let{children:t}=e;return(0,a.jsx)("div",{className:"overflow-x-auto mb-4 last:mb-0",children:(0,a.jsx)("table",{className:"table table-zebra w-full text-base-content/90",children:t})})},a(e){let{href:t,children:s}=e;return(0,a.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"link link-primary font-medium",children:s})},blockquote(e){let{children:t}=e;return(0,a.jsx)("blockquote",{className:"border-l-4 border-base-300 pl-4 my-4 text-base-content/90",children:t})}},children:s})})})]})}function h(e){let{selectedModel:t,onModelSelect:s,baseUrl:n}=e,[r,i]=(0,l.useState)([]),[o,c]=(0,l.useState)(!0),[d,m]=(0,l.useState)(null),u=(0,l.useCallback)(async()=>{try{m(null),c(!0);let a=await fetch("".concat(n,"/api/tags"));if(!a.ok)throw Error("Failed to fetch models");let l=(await a.json()).models||[];if(i(l),l.length>0&&!l.map(e=>e.name).includes(t)){var e;s((null===(e=l[0])||void 0===e?void 0:e.name)||"")}}catch(e){console.error("Error fetching models:",e),m("Failed to connect to Ollama server")}finally{c(!1)}},[n,t,s]);return((0,l.useEffect)(()=>{u()},[n,u]),o)?(0,a.jsx)("div",{className:"loading loading-spinner loading-sm"}):d?(0,a.jsx)("div",{className:"text-error text-sm",children:d}):(0,a.jsx)("select",{className:"select select-bordered w-full max-w-xs",value:t,onChange:e=>s(e.target.value),children:0===r.length?(0,a.jsx)("option",{value:"",children:"No models available"}):r.map(e=>(0,a.jsx)("option",{value:e.name,children:e.name},e.name))})}var x=s(59152),b=s(46217),g=s(11454);function f(e){let{onUrlChange:t,initialUrl:s,conversations:n,onConversationsImport:r}=e,[i,o]=(0,l.useState)(!1),[c,d]=(0,l.useState)(s),m=(0,l.useRef)(null);(0,l.useEffect)(()=>{d(s)},[s]);let u=e=>"object"==typeof e&&"string"==typeof e.id&&"string"==typeof e.title&&Array.isArray(e.messages)&&"string"==typeof e.model&&"string"==typeof e.createdAt&&"string"==typeof e.updatedAt;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"file",ref:m,className:"hidden",accept:".json",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!s)return;let a=new FileReader;a.onload=e=>{try{var t;let s=null===(t=e.target)||void 0===t?void 0:t.result,a=JSON.parse(s);if(!Array.isArray(a)||!a.every(u))throw Error("Invalid file format");r(a),o(!1)}catch(e){alert("Failed to import conversations. Please make sure the file is valid.")}},a.readAsText(s),e.target.value=""}}),(0,a.jsx)("button",{onClick:()=>o(!i),className:"btn btn-ghost btn-circle",title:"Settings",children:(0,a.jsx)(x.Z,{className:"h-5 w-5"})}),i&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-80 bg-base-100 rounded-lg shadow-lg p-4 border z-50",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Settings"}),(0,a.jsxs)("div",{className:"form-control mb-4",children:[(0,a.jsx)("label",{className:"label",children:(0,a.jsx)("span",{className:"label-text",children:"Ollama Server URL"})}),(0,a.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),className:"input input-bordered w-full",placeholder:"http://127.0.0.1:11434"})]}),(0,a.jsx)("div",{className:"divider my-2",children:"Chat History"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 mb-4",children:[(0,a.jsxs)("button",{onClick:()=>{let e=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="ollama-chat-history-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)},className:"btn btn-outline btn-sm gap-2",disabled:0===n.length,title:0===n.length?"No conversations to export":"Export conversations",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4"}),"Export Chat History"]}),(0,a.jsxs)("button",{onClick:()=>{var e;null===(e=m.current)||void 0===e||e.click()},className:"btn btn-outline btn-sm gap-2",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4"}),"Import Chat History"]})]}),(0,a.jsx)("div",{className:"divider my-2"}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>{d(s),o(!1)},className:"btn btn-ghost",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{t(c),o(!1)},className:"btn btn-primary",children:"Save"})]})]})]})}var p=s(43836),v=s(48217),j=s(61601);function N(e){let{conversations:t,currentConversationId:s,onSelect:l,onNew:n,onDelete:r}=e;return(0,a.jsxs)("div",{className:"w-64 border-r bg-base-200 flex flex-col h-full",children:[(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("button",{onClick:n,className:"btn btn-primary w-full gap-2",children:[(0,a.jsx)(p.Z,{className:"h-5 w-5"}),"New Chat"]})}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 hover:bg-base-300 cursor-pointer ".concat(e.id===s?"bg-base-300":""),onClick:()=>l(e),children:[(0,a.jsx)(v.Z,{className:"h-5 w-5 shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 truncate",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:e.title}),(0,a.jsx)("div",{className:"text-xs opacity-50",children:new Date(e.updatedAt).toLocaleString()})]}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),r(e.id)},className:"btn btn-ghost btn-xs",title:"Delete conversation",children:(0,a.jsx)(j.Z,{className:"h-4 w-4"})})]},e.id))})]})}var w=s(99158),y=s(70001);function S(){let[e,t]=(0,l.useState)(!1),[s,n]=(0,l.useState)("light");return((0,l.useEffect)(()=>{t(!0);let e=localStorage.getItem("theme"),s=window.matchMedia("(prefers-color-scheme: dark)").matches,a=e||(s?"dark":"light");n(a),document.documentElement.setAttribute("data-theme",a)},[]),e)?(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("button",{onClick:()=>{let e="light"===s?"dark":"light";n(e),document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)},className:"btn btn-circle btn-ghost","aria-label":"Toggle theme",children:"light"===s?(0,a.jsx)(w.Z,{className:"w-6 h-6"}):(0,a.jsx)(y.Z,{className:"w-6 h-6"})})}):null}let k=()=>localStorage.getItem("ollamaUrl")||"http://localhost:11434",C=()=>Math.random().toString(36).substring(2)+Date.now().toString(36);function E(){let[e,t]=(0,l.useState)(!1),[s,r]=(0,l.useState)([]),[i,o]=(0,l.useState)(null),[c,d]=(0,l.useState)(""),[m,x]=(0,l.useState)(!1),[b,g]=(0,l.useState)(""),[p,v]=(0,l.useState)(k),[j,w]=(0,l.useState)(null),[y,E]=(0,l.useState)("");(0,l.useEffect)(()=>{t(!0);let e=localStorage.getItem("conversations");if(e)try{let t=JSON.parse(e);r(t),t.length>0&&o(t[0].id)}catch(e){console.error("Failed to parse saved conversations:",e)}},[]),(0,l.useEffect)(()=>{e&&localStorage.setItem("conversations",JSON.stringify(s))},[s,e]);let O=s.find(e=>e.id===i),I=(0,l.useCallback)(()=>{let e={id:C(),title:"New Chat",messages:[],model:b,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};r(t=>[e,...t]),o(e.id)},[b]),A=(0,l.useCallback)(e=>{if(r(t=>t.filter(t=>t.id!==e)),i===e){var t;let a=s.filter(t=>t.id!==e);o(a.length>0&&(null===(t=a[0])||void 0===t?void 0:t.id)||null)}},[i,s]),D=(0,l.useCallback)(e=>{v(e),localStorage.setItem("ollamaUrl",e)},[]),Z=(0,l.useCallback)((e,t)=>{r(s=>s.map(s=>s.id===e?{...s,title:t.substring(0,30)+(t.length>30?"...":""),updatedAt:new Date().toISOString()}:s))},[]),U=async e=>{if(e.preventDefault(),!c.trim()||!b||m)return;if(!i){I();return}let t={role:"user",content:c},s=(null==O?void 0:O.messages)||[];r(e=>e.map(e=>{if(e.id===i){let s=[...e.messages,t];return 0===e.messages.length&&Z(e.id,c),{...e,messages:s,updatedAt:new Date().toISOString()}}return e})),d(""),x(!0),w(null),E("");try{var a,l;let e=await fetch("".concat(p,"/api/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:b,messages:[...s,t],stream:!0})});if(!e.ok)throw Error("Server error: ".concat(e.status));let n=null===(a=e.body)||void 0===a?void 0:a.getReader();if(!n)throw Error("Failed to read response");let o=new TextDecoder,c="";for(;;){let{done:e,value:t}=await n.read();if(e)break;for(let e of o.decode(t).split("\n"))if(""!==e.trim())try{let t=JSON.parse(e);(null===(l=t.message)||void 0===l?void 0:l.content)&&(c+=t.message.content,E(c))}catch(t){console.warn("Failed to parse line:",e)}}c&&r(e=>e.map(e=>e.id===i?{...e,messages:[...e.messages,{role:"assistant",content:c}],updatedAt:new Date().toISOString()}:e))}catch(e){console.error("Error in chat request:",e),w(e instanceof Error?e.message:"Failed to send message")}finally{x(!1),E("")}},R=O?[...O.messages,...y?[{role:"assistant",content:y}]:[]]:[],F=(0,l.useCallback)(e=>{r(t=>{let s=new Set(t.map(e=>e.id));return[...e.filter(e=>!s.has(e.id)),...t]})},[]);return e?(0,a.jsxs)("div",{className:"flex h-screen",children:[(0,a.jsx)(N,{conversations:s,currentConversationId:i,onSelect:e=>o(e.id),onNew:I,onDelete:A}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsx)("header",{className:"p-4 border-b",children:(0,a.jsxs)("div",{className:"flex items-center justify-between max-w-7xl mx-auto w-full",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Ollama Chat"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(h,{selectedModel:b,onModelSelect:g,baseUrl:p}),(0,a.jsx)(f,{onUrlChange:D,initialUrl:p,conversations:s,onConversationsImport:F}),(0,a.jsx)(S,{})]})]})}),(0,a.jsx)("main",{className:"flex-1 overflow-auto p-4",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[R.map((e,t)=>(0,a.jsx)(u,{role:e.role,content:e.content},"".concat(i,"-").concat(t))),j&&(0,a.jsxs)("div",{className:"text-error text-center p-4",children:["Error: ",j]})]})}),(0,a.jsx)("footer",{className:"p-4 border-t",children:(0,a.jsxs)("form",{onSubmit:U,className:"max-w-4xl mx-auto flex gap-4",children:[(0,a.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"Type your message...",className:"input input-bordered flex-1",disabled:m||!b}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:m||!b||!c.trim(),children:(0,a.jsx)(n.Z,{className:"w-5 h-5"})})]})})]})]}):null}}},function(e){e.O(0,[580,971,117,744],function(){return e(e.s=87593)}),_N_E=e.O()}]);