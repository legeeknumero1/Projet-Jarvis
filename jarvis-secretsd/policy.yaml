# Politique RBAC Jarvis - Principe du Moindre Privilège (PoLP)
# Chaque service ne voit QUE ce dont il a besoin.

clients:
  # Core Backend (Rust) : Orchestrateur central
  backend:
    allow:
      - "database_url"
      - "jwt_secret_key"
      - "jwt_algorithm"
      - "jwt_expiration_hours"
      - "postgres_password"
      - "redis_password"
      - "jarvis_encryption_key"
      - "brave_api_key"
      - "openweather_api_key"
      - "ollama_base_url"
      - "qdrant_url"
      - "jarvis_internal_key"
    permissions: [read]

  # Python Bridges (IA/LLM) : Accès limité aux modèles
  python-bridges:
    allow:
      - "ollama_api_key"
    permissions: [read]

  # STT (Speech-to-Text) : Aucun secret nécessaire pour le traitement local
  stt-api:
    allow: []
    permissions: []

  # TTS (Text-to-Speech) : Accès à la clé Piper si externe
  tts-api:
    allow: []
    permissions: []

  # Open-WebUI : Uniquement le JWT pour l'authentification session
  open-webui:
    allow:
      - "jwt_secret_key"
    permissions: [read]

  # Infrastructure (Postgres/Redis) : Uniquement leurs credentials respectifs
  postgres:
    allow: ["postgres_password"]
    permissions: [read]
  
  timescale:
    allow: ["postgres_password", "timescale_password"]
    permissions: [read]

  redis:
    allow: ["redis_password"]
    permissions: [read]

  # Monitoring : Peut lister les noms (métadonnées) mais JAMAIS lire les valeurs
  monitoring:
    allow: ["*"]
    permissions: [list]

  # Admin : Accès total pour la maintenance (uniquement via localhost/interne)
  admin:
    allow: ["*"]
    permissions: [admin]

default_deny: true