events {
    worker_connections 1024;
}

http {
    upstream jenkins {
        server jenkins:8080;
    }
    
    upstream argocd {
        server localhost:8081;  # ArgoCD accessible via port-forward
    }
    
    upstream grafana {
        server grafana:3000;
    }
    
    upstream prometheus {
        server prometheus:9090;
    }

    # Jenkins
    server {
        listen 80;
        server_name jenkins.jarvis.local;
        
        location / {
            proxy_pass http://jenkins;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # ArgoCD
    server {
        listen 80;
        server_name argocd.jarvis.local;
        
        location / {
            proxy_pass http://argocd;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Grafana
    server {
        listen 80;
        server_name grafana.jarvis.local;
        
        location / {
            proxy_pass http://grafana;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Prometheus
    server {
        listen 80;
        server_name prometheus.jarvis.local;
        
        location / {
            proxy_pass http://prometheus;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # DevOps Dashboard principal
    server {
        listen 80 default_server;
        server_name devops.jarvis.local;
        
        location / {
            return 200 '
<!DOCTYPE html>
<html>
<head>
    <title> Jarvis DevOps Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: #fff; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .services { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
        .service { background: #2d2d2d; padding: 20px; border-radius: 8px; border-left: 4px solid #00ff88; }
        .service h3 { margin-top: 0; color: #00ff88; }
        .service a { color: #4CAF50; text-decoration: none; }
        .service a:hover { text-decoration: underline; }
        h1 { text-align: center; color: #00ff88; }
        .status { display: inline-block; width: 10px; height: 10px; background: #00ff88; border-radius: 50%; margin-right: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1> Jarvis DevOps Control Center</h1>
        <div class="services">
            <div class="service">
                <h3><span class="status"></span> Jenkins CI/CD</h3>
                <p>Pipeline automation & builds</p>
                <a href="http://jenkins.jarvis.local" target="_blank">→ Open Jenkins</a>
            </div>
            <div class="service">
                <h3><span class="status"></span> ArgoCD GitOps</h3>
                <p>Continuous deployment</p>
                <a href="http://argocd.jarvis.local" target="_blank">→ Open ArgoCD</a>
            </div>
            <div class="service">
                <h3><span class="status"></span> Grafana Monitoring</h3>
                <p>Dashboards & visualization</p>
                <a href="http://grafana.jarvis.local" target="_blank">→ Open Grafana</a>
            </div>
            <div class="service">
                <h3><span class="status"></span> Prometheus Metrics</h3>
                <p>Metrics collection & alerts</p>
                <a href="http://prometheus.jarvis.local" target="_blank">→ Open Prometheus</a>
            </div>
        </div>
    </div>
</body>
</html>';
            add_header Content-Type text/html;
        }
    }
}